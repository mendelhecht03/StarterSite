<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fundraising Thermometer</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  body {
    font-family: Arial, sans-serif;
    background: #f0f0f5;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }

  .thermometer-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    width: max-content; /* container adapts to widest child */
  }

  .goal-label {
    font-size: 16px;
    font-weight: bold;
    color: #333;
    text-align: center;
    padding: 8px 16px;
    background: rgba(255,255,255,0.1);
    border-radius: 15px;
    border: 2px solid rgba(0,0,0,0.1);
    backdrop-filter: blur(8px);
    min-width: 150px;   /* ensures box isn't too small */
    display: inline-block;
    box-sizing: border-box;
  }

  .thermometer {
    width: 120px;
    height: 400px;
  }

  .counter {
    font-size: 20px;
    font-weight: bold;
    color: #333;
    text-align: center;
    margin-top: 20px;
    min-width: 150px;   /* match goal-label */
    display: inline-block;
  }

  .loading, .error-message {
    display: none;
    text-align: center;
    margin-top: 10px;
  }

  .spinner {
    border: 3px solid #f3f3f3;
    border-top: 3px solid #ff0000;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
  }

  .error-message { color: #ff0000; font-size: 14px; }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  @media(max-width:500px) {
    .thermometer-container { gap: 20px; }
    .thermometer { width: 80px; height: 300px; }
    .counter { font-size: 16px; min-width: 120px; }
    .goal-label { min-width: 120px; font-size: 14px; }
  }
</style>
</head>
<body>
<div class="thermometer-container">
  <div class="goal-label">Goal: $2,000,000</div>
  <div class="thermometer">
    <svg viewBox="0 0 120 400" width="120" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <!-- Gradient for glassy tube -->
        <linearGradient id="glassGradient" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#ffffff" stop-opacity="0.25"/>
          <stop offset="50%" stop-color="#d9d9d9" stop-opacity="0.05"/>
          <stop offset="100%" stop-color="#ffffff" stop-opacity="0.15"/>
        </linearGradient>

        <!-- Mercury gradient for gloss -->
        <linearGradient id="mercuryGloss" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="white" stop-opacity="0.5"/>
          <stop offset="50%" stop-color="white" stop-opacity="0.1"/>
          <stop offset="100%" stop-color="white" stop-opacity="0"/>
        </linearGradient>

        <!-- Full thermometer shape as mask for mercury -->
        <mask id="tubeMask">
          <path d="M60 20 
                   a20 20 0 0 1 20 20 
                   v240 
                   a40 40 0 1 1 -40 0 
                   V40 
                   a20 20 0 0 1 20 -20 z" fill="white"/>
        </mask>
      </defs>

      <!-- Mercury fill using proper masking -->
      <rect id="mercury" x="0" y="0" width="120" height="0" fill="#ff0000" mask="url(#tubeMask)"/>
      <rect id="mercuryGlossRect" x="0" y="0" width="120" height="0" fill="url(#mercuryGloss)" mask="url(#tubeMask)"/>

      <!-- Glassy tube -->
      <path d="M60 20 a20 20 0 0 1 20 20 v240 a40 40 0 1 1 -40 0 V40 a20 20 0 0 1 20 -20 z"
            fill="url(#glassGradient)" stroke="#555" stroke-width="4"/>

      <!-- Highlights -->
      <path d="M55 30 v220 a30 30 0 1 1 -20 0 V40 a15 15 0 0 1 15 -15 z"
            fill="white" opacity="0.15"/>

      <!-- Tick marks on top -->
      <g stroke="#555" stroke-width="1.5">
        <line x1="64" y1="40" x2="70" y2="40"/>
        <line x1="64" y1="70" x2="70" y2="70"/>
        <line x1="64" y1="100" x2="70" y2="100"/>
        <line x1="64" y1="130" x2="70" y2="130"/>
        <line x1="64" y1="160" x2="70" y2="160"/>
        <line x1="64" y1="190" x2="70" y2="190"/>
        <line x1="64" y1="220" x2="70" y2="220"/>
        <line x1="64" y1="250" x2="70" y2="250"/>
        <line x1="64" y1="280" x2="70" y2="280"/>
      </g>
    </svg>
  </div>
  <div class="counter">$0</div>
  <div class="loading" id="loading">
    <div class="spinner"></div>
    <div>Updating...</div>
  </div>
  <div class="error-message" id="errorMessage">
    Unable to load fundraising data. Please try again later.
  </div>
</div>

<script>
const CONFIG = {
  GOAL: 2000000,
  SHEET_ID: '1OpYPddAWN0S3mhiqZRXbeISQUWVtYeVApZXBBDW_jGg',
  API_KEY: 'AIzaSyD4rMGQG0Uy2rfIIHY83mwyRNu9iusXoLQ'
};

const elements = {
  mercury: document.getElementById('mercury'),
  mercuryGloss: document.getElementById('mercuryGlossRect'),
  counter: document.querySelector('.counter'),
  loading: document.getElementById('loading'),
  error: document.getElementById('errorMessage')
};

const utils = {
  formatCurrency: amount => `$${amount.toLocaleString()}`,
  parseAmount: value => parseFloat(value.replace(/[^0-9.-]/g, ''))
};

function animateTo(amount) {
  const startAmount = parseFloat(elements.counter.getAttribute('data-current') || '0');
  const endAmount = amount;
  const duration = 2000;
  const startTime = performance.now();

  // Full thermometer height for proper masking
  const fullHeight = 400; // Full SVG height
  const startY = 400; // Start from bottom

  function animate(time) {
    const progress = Math.min((time - startTime) / duration, 1);
    const current = startAmount + (endAmount - startAmount) * (1 - Math.pow(1 - progress, 3));

    elements.counter.textContent = utils.formatCurrency(Math.round(current));
    elements.counter.setAttribute('data-current', current);

    // Calculate mercury height as percentage of full thermometer
    const mercuryHeight = fullHeight * Math.min(1, current / CONFIG.GOAL);
    const mercuryY = startY - mercuryHeight;

    elements.mercury.setAttribute('y', mercuryY);
    elements.mercury.setAttribute('height', mercuryHeight);
    elements.mercuryGloss.setAttribute('y', mercuryY);
    elements.mercuryGloss.setAttribute('height', mercuryHeight);

    if (progress < 1) requestAnimationFrame(animate);
  }
  requestAnimationFrame(animate);
}

async function fetchFundraisingData() {
  try {
    elements.loading.style.display = 'block';
    elements.error.style.display = 'none';

    const url = `https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/Sheet1!B2?key=${CONFIG.API_KEY}`;
    const response = await fetch(url);
    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

    const data = await response.json();
    const rawValue = data.values?.[0]?.[0];
    if (!rawValue) throw new Error('No data found in B2');

    const amount = utils.parseAmount(rawValue);
    if (isNaN(amount)) throw new Error('Invalid data format in B2');

    animateTo(amount);
    elements.loading.style.display = 'none';

  } catch (error) {
    console.error('Error fetching data:', error);
    elements.loading.style.display = 'none';
    elements.error.style.display = 'block';
  }
}

function initThermometer() {
  elements.counter.textContent = utils.formatCurrency(0);
  elements.counter.setAttribute('data-current', '0');
  elements.mercury.setAttribute('height', '0');
  elements.mercuryGloss.setAttribute('height', '0');
  fetchFundraisingData();
}

document.addEventListener('DOMContentLoaded', initThermometer);
</script>
</body>
</html>
